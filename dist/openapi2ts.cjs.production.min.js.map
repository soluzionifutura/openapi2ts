{"version":3,"file":"openapi2ts.cjs.production.min.js","sources":["../src/index.ts"],"sourcesContent":["import { readFileSync, writeFileSync } from \"fs\"\nimport { compile } from \"json-schema-to-typescript\"\nimport type { OpenAPIV3_1 } from \"openapi-types\"\n\nexport type Options = { \n  openapi: OpenAPIV3_1.Document | string\n  bannerComment?: string\n  outputFilePath?: string\n}\n\nconst _dig = (obj: any) => {\n  for (const key in obj) {\n    if (key === \"$ref\") {\n      const ref = obj[key].split(\"/\").pop()\n      delete obj[key]\n      obj.tsType = ref\n    } else if (typeof obj[key] === \"object\") {\n      _dig(obj[key])\n    }\n  }\n\n  return obj\n}\n\nexport async function parse({\n  openapi,\n  outputFilePath,\n  bannerComment = `/* eslint-disable @typescript-eslint/ban-types */\n/* eslint-disable @typescript-eslint/member-delimiter-style */\n/**\n * This file was automatically generated by openapi2ts.\n * DO NOT MODIFY IT BY HAND. Instead, modify the source\n * openapi definition and regenerate this file.\n */\n`\n}: Options): Promise<{\n  data: string\n  exports: Set<string>\n}> {\n  if (typeof openapi === \"string\") {\n    openapi = JSON.parse(readFileSync(openapi, \"utf8\")) as OpenAPIV3_1.Document\n  } else {\n    openapi = JSON.parse(JSON.stringify(openapi)) as OpenAPIV3_1.Document\n  }\n\n  const exports = new Set<string>()\n\n  const data = bannerComment + (await Promise.all(Object.entries(openapi.components!.schemas!).map(([name, schema]) => {\n    if (exports.has(name)) {\n      throw new Error(`Duplicate schema name: ${name}`)\n    }\n\n    exports.add(name)\n\n    return compile(_dig(schema), name, {\n      bannerComment: \"\",\n      enableConstEnums: false,\n      style: {\n        semi: false\n      }\n    })\n  }))).join(\"\\n\")\n\n  if (outputFilePath) {\n    writeFileSync(outputFilePath, data)\n  }\n  \n  return {\n    data,\n    exports\n  }\n}"],"names":["_dig","obj","key","ref","split","pop","tsType","_parse","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref","openapi","outputFilePath","_ref$bannerComment","bannerComment","exports","data","wrap","_context","prev","next","JSON","parse","readFileSync","stringify","Set","t0","Promise","all","Object","entries","components","schemas","map","_ref2","name","schema","has","Error","add","compile","enableConstEnums","style","semi","t1","sent","join","writeFileSync","abrupt","stop","apply","arguments","_x"],"mappings":"k4NAUA,IAAMA,EAAO,SAAPA,EAAQC,GACZ,IAAK,IAAMC,KAAOD,EAChB,GAAY,SAARC,EAAgB,CAClB,IAAMC,EAAMF,EAAIC,GAAKE,MAAM,KAAKC,aACzBJ,EAAIC,GACXD,EAAIK,OAASH,MACgB,iBAAbF,EAAIC,IACpBF,EAAKC,EAAIC,IAIb,OAAOD,GAkDR,SAAAM,IAAA,OAAAA,EAAAC,EAAAC,IAAAC,MA/CM,SAAAC,EAAAC,GAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAT,IAAAU,eAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OAuBqB,OArB1BR,EAAcF,EAAdE,eACAE,YADcD,EAAAH,EACdI,kTAAaD,EAaXF,EADqB,iBAdvBA,EAAOD,EAAPC,SAeYU,KAAKC,MAAMC,eAAaZ,EAAS,SAEjCU,KAAKC,MAAMD,KAAKG,UAAUb,IAGhCI,EAAU,IAAIU,IAAaP,EAAAQ,GAEpBZ,EAAaI,EAAAE,OAAUO,QAAQC,IAAIC,OAAOC,QAAQnB,EAAQoB,WAAYC,SAAUC,KAAI,SAAAC,OAAEC,EAAID,KAAEE,EAAMF,KAC7G,GAAInB,EAAQsB,IAAIF,GACd,MAAM,IAAIG,gCAAgCH,GAK5C,OAFApB,EAAQwB,IAAIJ,GAELK,UAAQ1C,EAAKsC,GAASD,EAAM,CACjCrB,cAAe,GACf2B,kBAAkB,EAClBC,MAAO,CACLC,MAAM,SAGT,OAIF,OAJEzB,EAAA0B,GAAA1B,EAAA2B,KAAEC,KAAK,MAdJ9B,EAAIE,EAAAQ,GAAAR,EAAA0B,GAgBNhC,GACFmC,gBAAcnC,EAAgBI,GAC/BE,EAAA8B,gBAEM,CACLhC,KAAAA,EACAD,QAAAA,IACD,QAAA,UAAA,OAAAG,EAAA+B,UAAAxC,QACFyC,WAAAC,kCA/C0BC,GAAA,OAAA/C,EAAA6C,WAAAC"}